# Automation Setup - README Generation on Push

This document explains how to set up automatic documentation generation whenever you push code to GitHub.

## Overview

There are two ways to automate README generation:

1. **GitHub Actions (Cloud)** - Runs on GitHub's servers, works for all contributors
2. **Local Git Hooks** - Runs on your machine after each push

## Option 1: GitHub Actions (Recommended)

### Setup Steps

1. **Add Google API Key to GitHub Secrets**

   - Go to your GitHub repository
   - Navigate to `Settings` → `Secrets and variables` → `Actions`
   - Click `New repository secret`
   - Enter:
     - **Name**: `GOOGLE_API_KEY`
     - **Value**: Your Google Gemini API key
   - Click `Add secret`

2. **Verify Workflow File**

   - Check that `workflows/update-readme.yml` exists in your repository
   - It should already be configured to trigger on every push

3. **Make a Test Push**

   ```bash
   git add .
   git commit -m "test: trigger documentation workflow"
   git push
   ```

4. **Monitor Workflow**

   - Go to your GitHub repository
   - Click `Actions` tab
   - You should see "Auto Generate README via Google Gemini" workflow running
   - Once complete, README.md will be automatically committed to your branch

### How It Works

```
Your Push → GitHub Receives → Workflow Triggers → 
  Gemini AI Generates Docs → README.md Committed → 
    Changes Pushed Back
```

### Workflow Details

The GitHub Actions workflow:
- Runs on every push to any branch
- Sets up Node.js environment
- Installs dependencies
- Calls Google Gemini API to generate documentation
- Automatically commits and pushes README.md updates
- Shows status in GitHub Actions tab

## Option 2: Local Git Hooks

### Setup Steps

1. **Install the Post-Push Hook**

   ```bash
   cd sap-vendor-api
   npm run setup-hooks
   ```

2. **Set Environment Variable**

   **Windows (PowerShell):**
   ```powershell
   $env:GOOGLE_API_KEY = "your-api-key-here"
   ```

   **macOS/Linux:**
   ```bash
   export GOOGLE_API_KEY="your-api-key-here"
   ```

3. **Make a Test Push**

   ```bash
   git push
   ```

4. **Monitor the Hook**

   You'll see output in your terminal showing:
   - Hook activation
   - Dependency check
   - Documentation generation status
   - README.md update notification

### How It Works

```
Your Push → Hook Triggers → Gemini Generates Docs → 
  README.md Updated Locally → Ready for Next Commit
```

### Hook Behavior

The post-push hook:
- Only runs if `GOOGLE_API_KEY` is set (safe if not configured)
- Checks and installs dependencies if needed
- Generates documentation using Google Gemini
- Informs you about README.md changes
- Non-blocking - won't prevent push if something fails

### Disable Hook Temporarily

```bash
# Temporarily skip the hook for a single push
$env:SKIP_HOOK = 'true'; git push

# Or on macOS/Linux:
SKIP_HOOK=true git push
```

### Remove Hook

To uninstall the hook:

```bash
rm .git/hooks/post-push
```

## Comparison

| Feature | GitHub Actions | Local Hook |
|---------|---|---|
| Setup | GitHub Secrets required | One command |
| Runs on | GitHub servers | Your machine |
| Works for | All contributors | Only you |
| Automatic Commit | Yes | No |
| Requires API Key | In GitHub Secrets | Env variable |
| Network needed | Always | Yes |
| Speed | Slower (cloud overhead) | Faster (local) |

## Troubleshooting

### GitHub Actions

**Workflow doesn't appear to run:**
- Check that `GOOGLE_API_KEY` secret is added to GitHub
- Go to `Actions` tab → Verify workflow is present
- Look for error messages in workflow run logs

**README not updating:**
- Check workflow logs for Gemini API errors
- Verify API key is valid in GitHub Secrets
- Check API quota/usage in Google Cloud

**Infinite loops:**
- If README changes trigger more pushes, disable auto-commit
- Edit `update-readme.yml` to not push changes automatically

### Local Hook

**Hook not running:**
- Verify `GOOGLE_API_KEY` is set: `echo $GOOGLE_API_KEY`
- Check hook file exists: `ls -la .git/hooks/post-push`
- Check hook has execute permission: `chmod +x .git/hooks/post-push`

**API Key errors:**
- Make sure you set the environment variable before pushing
- Test with: `echo $GOOGLE_API_KEY` (should show your key)

**Dependency installation issues:**
- Ensure Node.js is installed: `node --version`
- Check internet connection for npm install

**Slow hook execution:**
- First run installs dependencies (slower)
- Subsequent runs are faster
- Consider running during off-hours for large repos

## File Structure

```
.
├── .git/
│   └── hooks/
│       └── post-push          # Generated by setup script
├── workflows/
│   └── update-readme.yml      # GitHub Actions workflow
├── scripts/
│   ├── setup-git-hooks.js     # Hook installation script
│   ├── post-push-hook.sh      # Hook for macOS/Linux
│   └── post-push-hook.bat     # Hook for Windows
├── generate-readme.js         # Main documentation generator
└── sap-vendor-api/
    └── package.json           # Includes setup-hooks script
```

## Environment Variables

### For Local Hook

```bash
# Required
GOOGLE_API_KEY=your-api-key-here

# Optional
SKIP_HOOK=true  # Skip hook for current push
```

### For GitHub Actions

Add only `GOOGLE_API_KEY` as a repository secret in GitHub Settings.

## Best Practices

1. **Use GitHub Actions for Team Projects** - Everyone benefits from auto-documentation
2. **Use Local Hooks for Personal Development** - Faster feedback loop
3. **Use Both** - GitHub Actions provides backups, local hook gives instant feedback
4. **Combine with CI/CD** - Run documentation checks in your test suite
5. **Review Generated Docs** - AI-generated docs may need manual refinement
6. **Add to .gitignore** - Consider excluding auto-generated README drafts
7. **Version Control Hooks** - Check in `scripts/post-push-hook.*` files

## Advanced Configuration

### Customize GitHub Actions

Edit `workflows/update-readme.yml`:

```yaml
# Change branch trigger
on:
  push:
    branches:
      - main  # Only main branch
      - develop

# Change commit message
git commit -m "docs: update README [skip ci]"  # Prevent loop

# Add additional steps
- name: Validate README
  run: npm run validate-docs
```

### Customize Local Hook

Edit `.git/hooks/post-push`:

```bash
# Add additional logic
- name: Push notifications
- name: Webhook calls
- name: Deployment triggers
```

## Security Considerations

1. **Never commit API keys** - Use environment variables or GitHub Secrets
2. **Limit hook permissions** - Hooks run with your user permissions
3. **Review workflow files** - Before committing workflows to repo
4. **Rotate API keys regularly** - Update GitHub Secrets periodically
5. **Use branch protection** - Prevent direct pushes to main branch

## Support & Help

- **API Issues**: [Google Generative AI Docs](https://ai.google.dev/)
- **Git Hooks**: [Git Hooks Documentation](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)
- **GitHub Actions**: [GitHub Actions Documentation](https://docs.github.com/en/actions)
- **NestJS**: [NestJS Documentation](https://docs.nestjs.com)

---

**Last Updated**: December 2, 2025
